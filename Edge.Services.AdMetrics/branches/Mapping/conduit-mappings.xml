<?xml version="1.0" encoding="utf-8" ?>

<MappingConfiguration>
	
	<Using Namespace="Edge.Data.Objects.{0}, Edge.Data.Pipeline"/>

	<Object Type="Ad">
		<Map To="Campaign">
			<Map To="Name" Field="Campaign"/>
			<Map To="Account" Field="AccountName" Value="{GetAccount(AccountName)}"/>
			<Map To="Channel" Field="Channel" Value="{GetChannel(Channel)}"/>
		</Map>

		<Map To="DestinationUrl" Field="destUrl"/>
		<Map To='Segments[{GetSegment("Adgroup")}]' Field="{new SegmentValue(Adgroup)}"/>
		<Map To='Segments[{GetSegment("Tracker")}]' Field="destUrl" Value='{GetAutoSegmentValue("Tracker", destUrl)}' />
			
		<Map To='Creatives[]::TextCreative'>
			<Map To="TextType" Value="Title"/>
			<Map To="Text" Field="Headline"/>
		</Map>
		<Map To='Creatives[]::TextCreative'>
			<Map To="TextType" Value="Body"/>
			<Map To="Text" Field="Desc1"/>
		</Map>
	</Object>

	<Object Type="AdMetricsUnit">
		<Read Name="dayCode" Field="Day_Code" Regex="(?{y}[0-9]{4})(?{m}[0-9]{2})(?{d}[0-9]{2})"/>
		<Map To="PeriodStart" Value='{CreatePeriodStart(dayCode.y, dayCode.m, dayCode.d)}'/>
		<Map To="PeriodEnd" Value="{CreatePeriodEnd(dayCode.y, dayCode.m, dayCode.d)}"/>

		<Map To='Measures[{GetMeasure("Impressions")}]' Field="Imps"/>
		<Map To='Measures[{GetMeasure("Clicks")}]' Field="Clicks"/>
		<Map To='Measures[{GetMeasure("Cost")}]' Field="Cost"/>
	</Object>
	

	<!--<Object Type="Ad">
		<Map To="Campaign.Channel" Value='{GetChannelByName("AdMob")}'/>
		--><!--<Map To="Campaign.Account.ID" Value="{Instance.Configuration.AccountID}"/>--><!--
		<Map To="Creatives[]::TextCreative">
			<Map To="Text" Field="Desc1"/>
			<Map To="TextType" Value="Body"/>
		</Map>
	</Object>

	<Object Type="AdMetricsUnit">
		<Read Field="DayCode" Regex="(?{y}[0-9]{4})(?{m}[0-9]{2})(?{d}[0-9]{2})"/>
		<Map To="PeriodStart" Value="\{date:{DayCode.y}-{DayCode.m}-{DayCode.d}, align: 'start'\}"/>
		<Map To="PeriodEnd" Value="\{date:{DayCode.y}-{DayCode.m}-{DayCode.d}, align: 'end'\}"/>
	</Object>-->


	<!--
	<Object Type="Ad">
		<Read Name="ALON" Field="testfields" Regex="(?{numbers}d+)(?{letters}[a-z]+)"/>
		<Map To="Name" Field="testfields" Regex="(?{numbers}d+)(?{letters}[a-z]+)" Value="{testfields.numbers}_{testfields.letters}"/>


		<Map To="Campaign.Channel.Name" Field="chnl"/>

		<Read Name="chnl" Field="chnl"/>
		<Map To="Campaign.Channel.Name" Value="{chnl}"/>


		<Map To="Campaign.Account.Name" Field="AccountName"/>
		<Map To="Campaign.Account" Field="AccountName" Value="{GetAccountByName(AccountName)}"/>
		<Map To="Campaign.Name" Field="Campaign"/>
		<Map To="Campaign">
			<Read Name="cc" Field="channel"/>
			<Map To="Channel.Name" Value="{cc}"/>
			<Map To="Channel">
				<Map To="Name" Field="channel"/>
			</Map>
			<Map To="Account">
				<Read Field="AccountName" Name="anm" Regex="(?{chicken}[A-Z]*)"/>
				<Map To="Name" Value="{anm.chicken}"/>
			</Map>
		</Map>
		<Map To="DestinationUrl" Field="destUrl"/>


		<Map To="Creatives[]::TextCreative">
			<Read Field="Desc1"/>
			<Read Field="Desc2"/>
			<Map To="TextType" Value="Body"/>
			<Map To="Text" Value="{Desc1}"/>
			<Map To="Text2" Value="{Desc2}"/>
		</Map>

		<Map To="Creatives[]::TextCreative.Text2" Field="Desc2"/>

		<Map To="Creatives[]::TextCreative" Field="creativeVisurl">
			<Map To="TextType" Value="DisplayUrl"/>
			<Map To="Text" Value="{creativeVisurl}"/>
		</Map>
		<Map To='Segments[{Segment("AdGroup")}]::SegmentValue' Field="Adgroup">
			<Map To="Value" Value="{Adgroup}"/>
		</Map>
		<Map To='Segments[{Segment("Tracker")}]::SegmentValue' Field="destUrl" Regex="\butm_content=(?{utm_content}\w+)\b">
			<Map To="Value" Value="{destUrl.utm_content}"/>
		</Map>
	</Object>

	<Object Type="AdMetricsUnit">
		<Read Field="DayCode" Regex="(?{y}[0-9]{4})(?{m}[0-9]{2})(?{d}[0-9]{2})"/>
		<Map To="PeriodStart" Value="\{date:{DayCode.y}-{DayCode.m}-{DayCode.d}, boundary: 'lower'}"/>
		<Map To="PeriodEnd" Value="\{date:{DayCode.y}-{DayCode.m}-{DayCode.d}, boundary: 'upper'}"/>

		<Map To="TargetMatches[]::KeywordTarget.Keyword" Field="Keyword"/>

		<Read Field="Imps"/>
		<Map To='Measures[{Measure("Impressions")}]' Field="Imps" Value="{ Convert.ToDouble(Imps) / 2}"/>
		<Map To='Measures[{Measure("Clicks")}]' Field="Clicks"/>
		<Map To='Measures[{Measure("Cost")}]' Field="Cost"/>
	</Object>
	-->
	
</MappingConfiguration>